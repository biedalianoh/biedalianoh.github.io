<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="javascript,react," />





  <link rel="alternate" href="/atom.xml" title="Chavin's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="兼容react支持 &amp;gt;= ie8
导入react虽然页面中没有用上React变量，但是也需要引入。因为只要有jsx的地方，就需要有React变量。1234import React, &amp;#123;Component&amp;#125; from &apos;react&apos;class ClickCounter extends Component &amp;#123;&amp;#125;
react构建工具create-react-">
<meta property="og:type" content="article">
<meta property="og:title" content="React重新出发">
<meta property="og:url" content="http://yoursite.com/2018/01/08/react-update/index.html">
<meta property="og:site_name" content="Chavin's Blog">
<meta property="og:description" content="兼容react支持 &amp;gt;= ie8
导入react虽然页面中没有用上React变量，但是也需要引入。因为只要有jsx的地方，就需要有React变量。1234import React, &amp;#123;Component&amp;#125; from &apos;react&apos;class ClickCounter extends Component &amp;#123;&amp;#125;
react构建工具create-react-">
<meta property="og:updated_time" content="2018-02-27T12:57:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React重新出发">
<meta name="twitter:description" content="兼容react支持 &amp;gt;= ie8
导入react虽然页面中没有用上React变量，但是也需要引入。因为只要有jsx的地方，就需要有React变量。1234import React, &amp;#123;Component&amp;#125; from &apos;react&apos;class ClickCounter extends Component &amp;#123;&amp;#125;
react构建工具create-react-">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: "",
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> React重新出发 | Chavin's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  








  
  

  <div class="container one-collumn  page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Chavin's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">FE Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      


      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                React重新出发
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-01-08T12:38:49+08:00" content="2018-01-08">
              2018-01-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Javascript/" itemprop="url" rel="index">
                    <span itemprop="name">Javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h1><p>react支持 &gt;= ie8</p>
<h1 id="导入react"><a href="#导入react" class="headerlink" title="导入react"></a>导入react</h1><p>虽然页面中没有用上React变量，但是也需要引入。<br>因为只要有jsx的地方，就需要有React变量。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">import React, &#123;Component&#125; from <span class="string">'react'</span></div><div class="line">class ClickCounter extends Component &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="react构建工具"><a href="#react构建工具" class="headerlink" title="react构建工具"></a>react构建工具</h1><h2 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create-react-app"></a>create-react-app</h2><p>facebook官方构建工具</p>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>有四个命令。具体命令的配置，都隐藏在node_modules中的<strong>react-scripts</strong>包中了。<br>其中<strong>eject</strong>命令表示不可逆的把隐藏的配置，都拿到外面来。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"start"</span>: <span class="string">"react-scripts start"</span></div><div class="line">    <span class="string">"build"</span>: <span class="string">"react-scripts build"</span>,</div><div class="line">    <span class="string">"test"</span>: <span class="string">"react-scripts test --env=jsdom"</span>,</div><div class="line">    <span class="string">"eject"</span>: <span class="string">"react-scripts eject"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="react-boilerplate"><a href="#react-boilerplate" class="headerlink" title="react-boilerplate"></a>react-boilerplate</h2><p>github: <a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="external">https://github.com/react-boilerplate/react-boilerplate</a><br>官网：<a href="https://www.reactboilerplate.com" target="_blank" rel="external">https://www.reactboilerplate.com</a></p>
<h2 id="react-redux-starter-kit"><a href="#react-redux-starter-kit" class="headerlink" title="react-redux-starter-kit"></a>react-redux-starter-kit</h2><h1 id="组件构建方式"><a href="#组件构建方式" class="headerlink" title="组件构建方式"></a>组件构建方式</h1><h2 id="React-createClass"><a href="#React-createClass" class="headerlink" title="React.createClass"></a>React.createClass</h2><p>react出现之初，实用React.createClass这种es5的方法来创造组件类，这种方法已经被废弃了。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var Counter = React.createClass(&#123;</div><div class="line">    propTypes: &#123;&#125;</div><div class="line">    ...</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="ES6-classes"><a href="#ES6-classes" class="headerlink" title="ES6 classes"></a>ES6 classes</h2><p>推荐<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Counter extends Component &#123;</div><div class="line">    constructor(props) &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="无状态函数"><a href="#无状态函数" class="headerlink" title="无状态函数"></a>无状态函数</h2><p>纯展示组件。只负责根据传入的props来展示，不涉及state。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function TodoApp() &#123;</div><div class="line">    return (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;Todos /&gt;</div><div class="line">            &lt;Filter /&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line">ReactDOM.render(&lt;TodoApp name=&quot;todo&quot; /&gt;, document.getElementById(&apos;root&apos;))</div></pre></td></tr></table></figure></p>
<h1 id="React组件命名"><a href="#React组件命名" class="headerlink" title="React组件命名"></a>React组件命名</h1><p>react判断一个元素是HTML还是React组件的原则，是看第一个字母是否大写。</p>
<h1 id="React生命周期"><a href="#React生命周期" class="headerlink" title="React生命周期"></a>React生命周期</h1><p>主要分为装载、更新、卸载这三个过程。<br>无状态组件是没有生命周期方法的。即无props和state</p>
<h2 id="装载–第一次被渲染"><a href="#装载–第一次被渲染" class="headerlink" title="装载–第一次被渲染"></a>装载–第一次被渲染</h2><p>初次加载时依次执行下列方法：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">class App extends Component&#123;</div><div class="line">    constructor(props) &#123;  //构造函数</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">getInitialState</span></span>() &#123;   //初始化this.state, 但是只有用React.createClass创造的才会起作用</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">getDefaultProps</span></span>() &#123;   //初始化this.props, 但是只有用React.createClass创造的才会起作用</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">componentWillMount</span></span>() &#123;  //render渲染之前。没啥作用，因为可做的都在constructor做了</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">render</span></span>() &#123;  //渲染dom</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">componentDidMount</span></span>() &#123;   //所有dom渲染完成之后调用。</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>this.foo = ::foo<br>等同于<br>this.foo = this.foo.bind(this)<br>::为bind操作符，但是可能不会成为ES标准语法。</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>更新时依次执行下列方法：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">class App extends Component &#123;</div><div class="line">    componentWillReceiveProps(nextProps) &#123;</div><div class="line">        //父组件render函数触发时，此方法会执行</div><div class="line">        //准备更新props</div><div class="line">    &#125;</div><div class="line">    shouldComponentUpdate(nextProps, nextState) &#123;   </div><div class="line">        //待更新props和state，做组件更新判断，若返回<span class="literal">true</span>则更新，<span class="literal">false</span>则不再向下执行生命周期</div><div class="line">        //通过nextProps, nextState 和 this.props, this.state 来进行对比判断</div><div class="line">    &#125;</div><div class="line">    componentWillUpdate(nextProps, nextState) &#123;</div><div class="line">        //更新前</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">render</span></span>() &#123;  //渲染dom</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    ComponentDidUpdate(prevProps, prevState) &#123;</div><div class="line">        //更新后</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>state数据更新后，为了让子组件或者其他依赖此state的地方同时更新，需要做数据更新渲染，如：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">class CounterContainer extends Component &#123;</div><div class="line">    <span class="function"><span class="title">constructor</span></span>() &#123;</div><div class="line">        super(...arguments)</div><div class="line"></div><div class="line">        this.state = this.getOwnState()</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">getOwnState</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> &#123;</div><div class="line">            value: this.context.store.getState()[this.props.caption]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">onChange</span></span>() &#123;</div><div class="line">        this.setState(this.getOwnState())</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">componentDidMount</span></span>() &#123;</div><div class="line">        this.context.store.subscribe(this.onChange)</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">componentWillUnmount</span></span>() &#123;</div><div class="line">        this.context.store.unsubscribe(this.onChange)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><p>卸载只有一个函数：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class App extends Component &#123;</div><div class="line">    <span class="function"><span class="title">componentWillUnmount</span></span>() &#123;    </div><div class="line">        //卸载前</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="React数据流"><a href="#React数据流" class="headerlink" title="React数据流"></a>React数据流</h1><h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>state是组件内部状态。在内部定义<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class Counter extends Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line"></div><div class="line">        this.state = &#123;</div><div class="line">            count: 0</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="setState"><a href="#setState" class="headerlink" title="setState"></a>setState</h3><p>state只能通过方法setState来实现修改<br>setState是异步方法<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">class Counter extends Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line">        this.handleClick = this.handleClick.bind(this)</div><div class="line">        this.state = &#123;</div><div class="line">            count: 0</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    handleClick(e) &#123;</div><div class="line">        e.preventDefault()</div><div class="line">        this.setState(&#123;</div><div class="line">            count: count + 1</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>组件之间传递数据。<br>组件不能修改传入的props<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">父组件：</div><div class="line"><span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;Counter caption=<span class="string">"senond"</span> initValue=&#123;10&#125;&gt;&lt;/Counter&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line">子组件</div><div class="line">constructor(props) &#123;</div><div class="line">    super(props)</div><div class="line">    console.log(this.props)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="props数据规范"><a href="#props数据规范" class="headerlink" title="props数据规范"></a>props数据规范</h3><p>通过propTypes来实现。<br>React 15.5.0之前可使用 React.PropTypes来检测。<br>可以全都使用prop-types来检测<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">import PropsTypes from <span class="string">'prop-types'</span></div><div class="line"></div><div class="line">...</div><div class="line">1. 可以在外面定义</div><div class="line">Counter.propTypes = &#123;</div><div class="line">    caption: PropTypes.string.isRequired,           </div><div class="line">    initValue: PropTypes.number</div><div class="line">&#125;</div><div class="line">Counter.defaultProps = &#123;</div><div class="line">    initValue: 0</div><div class="line">&#125;</div><div class="line"></div><div class="line">2. 也可以在里面定义</div><div class="line">class Counter extends Components &#123;</div><div class="line">    static propTypes = &#123;&#125;</div><div class="line">    static defaultProps = &#123;&#125;</div><div class="line">    constructor(props) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h2><p>获取组件实例<br>两种方式：</p>
<ol>
<li><p>绑定到this上<br>绑定到this上之后，直接通过this调用</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">handleClick</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span>(this.myTextInput !== null) &#123;</div><div class="line">        this.myTextInput.focus()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> ref=&#123;ref =&gt; this.myTextInput = ref&#125; /&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>直接字符串<br>通过字符串定义，通过refs获取</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class App extends Component &#123;</div><div class="line">    <span class="function"><span class="title">componentDidMount</span></span>() &#123;</div><div class="line">        const myComp = this.refs.myComp</div><div class="line">        const dom = findDOMNode(myComp)</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> (</div><div class="line">            &lt;div&gt;</div><div class="line">                &lt;Comp ref=<span class="string">"myComp"</span> /&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="组件拆分"><a href="#组件拆分" class="headerlink" title="组件拆分"></a>组件拆分</h2><p>为了结构化组件的构成，一般会把一个组件分为两个部分：</p>
<ol>
<li>容器组件<br>和store打交道，初始化组件的状态，监听store的变化，驱动组件重新渲染，等等动态。然后把props传给傻瓜组件。</li>
<li>傻瓜组件<br>纯粹渲染dom元素。只通过props渲染，无需state</li>
</ol>
<h3 id="原生组件拆分"><a href="#原生组件拆分" class="headerlink" title="原生组件拆分"></a>原生组件拆分</h3><p>一般这两个组件写在一个文件里面。如：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Counter extends Component &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line">class CounterContainer extends Component &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default CounterContainer;</div></pre></td></tr></table></figure></p>
<h3 id="react-redux组件拆分"><a href="#react-redux组件拆分" class="headerlink" title="react-redux组件拆分"></a>react-redux组件拆分</h3><p>react-redux提供了connect方法，通过connect方法无需调用this.context.store，而是直接从参数获取state了：<br>通过这种方式，view的组件则都变为无状态组件，均可通过函数来定义组件。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">import * as Actions from <span class="string">'../Actions.js'</span></div><div class="line">import &#123;connect&#125; from <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">function</span> Counter(&#123;caption, onIncrement, onDecrement, value&#125;) &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;div&gt;&lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> mapStateToProps(state, ownProps) &#123;     //业内一般叫这个函数名</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        value: state[ownProps.caption]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> mapDispatchToProps(dispatch, ownProps) &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        onIncrement: () =&gt; &#123;</div><div class="line">            dispatch(Actions.increment(ownProps.caption))</div><div class="line">        &#125;,</div><div class="line">        onDecrement: () =&gt; &#123;</div><div class="line">            dispatch(Actions.decrement(ownProps.caption))</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default connect(mapStateToProps, mapDispatchToProps)(Counter)</div></pre></td></tr></table></figure></p>
<p>用此之后，无需再定义一个外层组件。</p>
<h1 id="子组件通知父组件"><a href="#子组件通知父组件" class="headerlink" title="子组件通知父组件"></a>子组件通知父组件</h1><h2 id="react原生方式"><a href="#react原生方式" class="headerlink" title="react原生方式"></a>react原生方式</h2><p>主要是通过props中的函数来实现。<br>子组件中直接调用props中的方法，父组件就能响应<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">// 父组件</div><div class="line">onCounterUpdate(newValue, previousValue) &#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;Counter onUpdate=&#123;this.onCounterUpdate&#125;&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 子组件</div><div class="line">class Counter extends Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">updateCount</span></span>() &#123;</div><div class="line">        ...</div><div class="line">        this.props.onUpdate(newValue, previousValue)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Counter.protoTypes = &#123;</div><div class="line">    onUpdate: PropTypes.func</div><div class="line">&#125;</div><div class="line">Counter.defaultProps = &#123;</div><div class="line">    onUpate: f =&gt; f</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="React之外DOM操作"><a href="#React之外DOM操作" class="headerlink" title="React之外DOM操作"></a>React之外DOM操作</h1><p>大部分操作通过React的内置属性和方法能完成，但还有如Audio/Vide的play方法和input的focus方法，React就无能为力，这时需实用DOM操作<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">hidePopup(e) &#123;</div><div class="line">    const node = ReactDOM.findDOMNode(this)</div><div class="line">    const target = e.target || e.srcElement</div><div class="line">    const isInside = node.contains(target)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="React的方法"><a href="#React的方法" class="headerlink" title="React的方法"></a>React的方法</h1><h2 id="forceUpdate"><a href="#forceUpdate" class="headerlink" title="forceUpdate"></a>forceUpdate</h2><p>强行引发一次重新绘制<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;button onClick=&#123;() =&gt; this.forceUpdate()&#125;&gt;重新绘制&lt;/button&gt;</div></pre></td></tr></table></figure></p>
<h1 id="flux"><a href="#flux" class="headerlink" title="flux"></a>flux</h1><p>学习redux之前，先简单了解一下flux，会对redux理解更深</p>
<h1 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h1><p>redux一般使用唯一的一个store对象，并不像flux定义多个。这个store包含了所有的操作。<br>redux不修改state，而是给出一个新的state对象<br>redux作用过程：</p>
<ol>
<li>通过dispatch发送action对象，2. Store收到action，通过reducer进行处理，返回一个新的state对象，来更新视图。</li>
</ol>
<h2 id="如何创建并管理一个组件"><a href="#如何创建并管理一个组件" class="headerlink" title="如何创建并管理一个组件"></a>如何创建并管理一个组件</h2><p>包含<br>一. 一个组件自己的定义<br>二. 组件怎么接入项目中<br>为了说明这个整体框架，篇幅较长，因为整体框架最重要，订好框架，其中的细节则为具体开发内容。</p>
<ol>
<li><p>首先创建一个store.js<br>可以在此给定初始的state，一般这个值由服务端给。<br>通过所有组件的reducer来创建一个store。</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import &#123;createStore, combineReducers&#125; from <span class="string">'redux'</span></div><div class="line">import &#123;reducer as todoReducer&#125; from <span class="string">'./todos'</span></div><div class="line">import &#123;reducer as filterReducer&#125; from <span class="string">'./filter'</span></div><div class="line"></div><div class="line">const reducer = combineReducers(&#123;</div><div class="line">    todos: todoReducer,</div><div class="line">    filter: filterReducer</div><div class="line">&#125;)</div><div class="line"><span class="built_in">export</span> default createStore(reducer, 此处为state初始值也可以不写)</div></pre></td></tr></table></figure>
</li>
<li><p>整体组件外面，使用react-redux的Provider，把store当prop传到总组件上。这样一来下面的各个子组件则都能调用store</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">        &lt;TodoApp /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    document.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p>整体组件下面可包含页面的html和各类子组件的view</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import React from <span class="string">'react'</span></div><div class="line">import &#123;view as Todos&#125; from <span class="string">'./todos'</span></div><div class="line">import &#123;view as Filter&#125; from <span class="string">'./filter'</span></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">TodoApp</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;Todos /&gt;</div><div class="line">            &lt;Filter /&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default TodoApp</div></pre></td></tr></table></figure>
</li>
<li><p>每个子组件，单独建立一个文件夹。文件夹里面包含自己的一整套view，action.js，actionType.js，reducer.js<br>因为这个子组件，可能包含多个元素，因此view用一个文件夹views包起来。<br>4.1 action代表着用户所要执行的操作的名字，参数<br>其中type值为必须的，通过此判断所要执行哪个操作</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> const addTodo = text =&gt; (&#123;</div><div class="line">    <span class="built_in">type</span>: ADD_TODO,</div><div class="line">    completed: <span class="literal">false</span>,</div><div class="line">    id: nextTodoId++,</div><div class="line">    text</div><div class="line">&#125;)</div><div class="line"><span class="built_in">export</span> const toggleTodo = id =&gt; &#123;</div><div class="line">    console.log(id)</div><div class="line">    <span class="built_in">return</span> (&#123;</div><div class="line">        <span class="built_in">type</span>: TOGGLE_TODO,</div><div class="line">        id</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>4.2 actionType代表action的type字符串，通过一个文件专门管理，就能统一命名，避免重复<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> const ADD_TODO = <span class="string">'TODO/ADD'</span></div><div class="line"><span class="built_in">export</span> const TOGGLE_TODO = <span class="string">'TODO/TOGGLE'</span></div><div class="line"><span class="built_in">export</span> const REMOVE_TODO = <span class="string">'TODO/REMOVE'</span></div></pre></td></tr></table></figure></p>
<p>4.3 reducer代表对state所做的具体操作。<br>reducer中获取到的state是通过参数获取的，而且参数中获取的state只是对应为自己组件的state<br>其中不能直接修改state，如使用push，pop之类的方法。而是每次都返回一个新的state。可通过es6的解构操作符来实行<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> default (state = [], action) =&gt; &#123;    //这里的state实际对应为整体的state.todos</div><div class="line">    switch(action.type) &#123;</div><div class="line">        <span class="keyword">case</span> ADD_TODO: &#123;</div><div class="line">            <span class="built_in">return</span> [&#123;</div><div class="line">                id: action.id,</div><div class="line">                text: action.text,</div><div class="line">                completed: <span class="literal">false</span></div><div class="line">            &#125;,</div><div class="line">            ...state</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> TOGGLE_TODO: &#123;</div><div class="line">            <span class="built_in">return</span> state.map(todoItem =&gt; &#123;</div><div class="line">                <span class="keyword">if</span>(todoItem.id === action.id) &#123;</div><div class="line">                    <span class="built_in">return</span> &#123;...todoItem, completed: !todoItem.completed&#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="built_in">return</span> todoItem</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> REMOVE_TODO: &#123;</div><div class="line">            <span class="built_in">return</span> state.filter(todoItem =&gt; &#123;</div><div class="line">                <span class="built_in">return</span> todoItem.id !== action.id</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        default:</div><div class="line">            <span class="built_in">return</span> state</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>view代表着用户具体的html和操作<br>包含两方面：获取state来展示信息；对应的操作来连接action<br>是通过把state和操作转化为prop传给组件，来让组件使用。主要通过redux的connect方法来实现这个转化过程<br>用户的操作转化到action是通过redux的dispatch方法传递action方法来实现<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">import React from <span class="string">'react'</span></div><div class="line">import PropTypes from <span class="string">'prop-types'</span></div><div class="line">import &#123;connect&#125; from <span class="string">'react-redux'</span></div><div class="line">import TodoItem from <span class="string">'./todoItem'</span></div><div class="line">import &#123;toggleTodo, removeTodo&#125; from <span class="string">'../actions'</span></div><div class="line">import &#123;FilterTypes&#125; from <span class="string">'../../constants'</span></div><div class="line"></div><div class="line">//定义组件，并且通过参数使用props的属性和方法</div><div class="line">const TodoList = (&#123;todos, onToggleTodo, onRemoveTodo&#125;) =&gt; &#123;     </div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        &lt;ul className = <span class="string">'todo-list'</span>&gt;</div><div class="line">        &#123;</div><div class="line">            todos.map(item =&gt; (</div><div class="line">                &lt;TodoItem</div><div class="line">                    key=&#123;item.id&#125;</div><div class="line">                    text=&#123;item.text&#125;</div><div class="line">                    completed=&#123;item.completed&#125;</div><div class="line">                    onToggle=&#123;() =&gt; onToggleTodo(item.id)&#125;</div><div class="line">                    onRemove=&#123;() =&gt; onRemoveTodo(item.id)&#125;</div><div class="line">                /&gt;</div><div class="line">            ))</div><div class="line">        &#125;</div><div class="line">        &lt;/ul&gt;</div><div class="line">    )</div><div class="line">&#125;</div><div class="line">//定义组件必须的props</div><div class="line">TodoList.propTypes = &#123;</div><div class="line">    todos: PropTypes.array.isRequired</div><div class="line">&#125;</div><div class="line">const selectVisibleTodos = (todos, filter) =&gt; &#123;</div><div class="line">    switch(filter) &#123;</div><div class="line">        <span class="keyword">case</span> FilterTypes.ALL:</div><div class="line">            <span class="built_in">return</span> todos</div><div class="line">        <span class="keyword">case</span> FilterTypes.COMPLETED:</div><div class="line">            <span class="built_in">return</span> todos.filter(item =&gt; item.completed)</div><div class="line">        <span class="keyword">case</span> FilterTypes.UNCOMPLETED:</div><div class="line">            <span class="built_in">return</span> todos.filter(item =&gt; !item.completed)</div><div class="line">        default:</div><div class="line">            throw new Error(<span class="string">'unsuppport filter'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">//把state中的属性转为props属性</div><div class="line">const mapStateToProps = state =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        todos: selectVisibleTodos(state.todos, state.filter)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">//把state中的属性转为props方法</div><div class="line">const mapDispatchToProps = dispatch =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        onToggleTodo: id =&gt; &#123;</div><div class="line">            dispatch(toggleTodo(id))</div><div class="line">        &#125;,</div><div class="line">        onRemoveTodo: id =&gt; &#123;</div><div class="line">            dispatch(removeTodo(id))</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">//使用redux的connect方法来完成state到props的转化</div><div class="line"><span class="built_in">export</span> default connect(mapStateToProps, mapDispatchToProps)(TodoList)</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="创建一个store"><a href="#创建一个store" class="headerlink" title="创建一个store"></a>创建一个store</h2><p>store包含了三个方法：getState(获取state), dispatch(发送状态请求), subscribe(监听state)<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import &#123;createStore&#125; from <span class="string">'redux'</span></div><div class="line"><span class="built_in">let</span> &#123;getState, dispatch, subscribe&#125; = createStore(reducer)</div></pre></td></tr></table></figure></p>
<p>createStore还可接收第二个参数，表示state的初始状态。通常由服务器给出。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> store = createStore(reducer, window.STATE_FROM_SERVER)      //若提供这个参数，会覆盖reducer默认初始值</div><div class="line">如：</div><div class="line"><span class="built_in">export</span> default createStore(reducer, &#123;</div><div class="line">    todos: [&#123; id: 1, text: <span class="string">'originTask'</span>, completed: <span class="literal">false</span> &#125;],</div><div class="line">    filter: <span class="string">'已完成'</span></div><div class="line">&#125;)</div><div class="line">其中组件对应组件各自的state</div></pre></td></tr></table></figure></p>
<h2 id="原生获取store"><a href="#原生获取store" class="headerlink" title="原生获取store"></a>原生获取store</h2><p>一般为每个组件引入store.js文件，这样不利于工程化。<br>为了能在所有子组件中能实用store，可在总的子组件上层再加上一个provider层，这个层上赋上store，使得所有子组件能调用store</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">1. 建立provider.js</div><div class="line">import &#123;PropTypes, Component&#125; from <span class="string">'react'</span></div><div class="line">class Provider extends Component &#123;</div><div class="line">    <span class="function"><span class="title">getChildContext</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> &#123;</div><div class="line">            store: this.props.store</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">        <span class="built_in">return</span> this.props.children</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Provider.propTypes = &#123;</div><div class="line">    store: PropTypes.object.isRequired</div><div class="line">&#125;</div><div class="line">Provider.childContextTypes = &#123;</div><div class="line">    store: PropTypes.object</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default Provider</div><div class="line"></div><div class="line">2. 在index.js中把Provider设置为顶部组件</div><div class="line">import ControlPanel from <span class="string">'./views/controlPanel'</span></div><div class="line">import store from <span class="string">'./Store.js'</span></div><div class="line">import Provider from <span class="string">'./Provider.js'</span></div><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">        &lt;ControlPanel /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    document.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div><div class="line"></div><div class="line">3. 子组件中调用store</div><div class="line">class CounterContainer extends Component &#123;</div><div class="line">    constructor(props, context) &#123;</div><div class="line">        super(props, context)</div><div class="line">    &#125;</div><div class="line">    或者：</div><div class="line">    <span class="function"><span class="title">constructor</span></span>() &#123;</div><div class="line">        super(...arguments)</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="title">onIncrement</span></span>() &#123;</div><div class="line">        this.context.store.dispatch(Actions.increment(this.props.cation))</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="react-redux-获取store"><a href="#react-redux-获取store" class="headerlink" title="react-redux 获取store"></a>react-redux 获取store</h2><p>react-redux提供了provider功能。<br>如：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import &#123;Provider&#125; from <span class="string">'react-redux'</span></div><div class="line">import ControlPanel from <span class="string">'./views/ControlPanel'</span></div><div class="line">import store from <span class="string">'./Store.js'</span></div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;store&#125;&gt;      //其中store必须包含三个函数：subscribe,dispatch,getState</div><div class="line">        &lt;ControlPanel /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    document.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h2 id="关于state"><a href="#关于state" class="headerlink" title="关于state"></a>关于state</h2><p>应用了redux之后，就有存储在store上的state。<br>另外，每个组件自身也有自己的state</p>
<ol>
<li>store上的state<br>主要有两个地方会获取state。<br>一个为views中的html内容上的mapStateToProps函数中使用state转化为prop<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const mapStateToProps = state =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        todos: selectVisibleTodos(state.todos, state.filter)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">const mapDispatchToProps = dispatch =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        onToggleTodo: id =&gt; &#123;</div><div class="line">            dispatch(toggleTodo(id))</div><div class="line">        &#125;,</div><div class="line">        onRemoveTodo: id =&gt; &#123;</div><div class="line">            dispatch(removeTodo(id))</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">export</span> default connect(mapStateToProps, mapDispatchToProps)(TodoList)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>另一个为reducer中定义和使用的state<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> default (state = [], action) =&gt; &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        <span class="keyword">case</span> ADD_TODO: &#123;</div><div class="line">            <span class="built_in">return</span> [&#123;</div><div class="line">                id: action.id,</div><div class="line">                text: action.text,</div><div class="line">                completed: <span class="literal">false</span></div><div class="line">            &#125;,</div><div class="line">            ...state</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>组件自身的state<br>即定义组件自身state状态，和调用setState设置state。此state只在组件内部流通<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">class Counter extends Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line">        this.handleClick = this.handleClick.bind(this)</div><div class="line">        this.state = &#123;</div><div class="line">            count: 0</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    handleClick(e) &#123;</div><div class="line">        e.preventDefault()</div><div class="line">        this.setState(&#123;</div><div class="line">            count: count + 1</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="getState"><a href="#getState" class="headerlink" title="getState"></a>getState</h2><p>获取state<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store.getState()</div></pre></td></tr></table></figure></p>
<h2 id="action"><a href="#action" class="headerlink" title="action"></a>action</h2><p>用户的一个行为就是一个action，用户有多少种行为，就有多少个action。<br>很多action的时候，可以定义一个函数来生成action。<br>一般action的格式为：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">const action = &#123;</div><div class="line">    <span class="built_in">type</span>: <span class="string">'ADD_TODO'</span>,           //<span class="built_in">type</span>为必须的</div><div class="line">    payload: <span class="string">'Learn Redux'</span>      //所要传递的数据</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h2><p>用户的行为action，只能通过dispatch来发送。dispatch的参数为action<br>如：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store.dispatch(&#123;</div><div class="line">    <span class="built_in">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">    payload: <span class="string">'Learn Redux'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>reducer是一个函数，接受action和当前state做参数，然后返回一个新的state<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">const reducer = <span class="keyword">function</span>(state, action) &#123;</div><div class="line">    ...</div><div class="line">    <span class="built_in">return</span> new_state</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>reducer是一个纯函数，即同样的输入，会得到同样的输出。<br>纯函数是函数式变成的改练，需要遵守约束：</p>
<ol>
<li>不得改写参数，参数只能调用</li>
<li>不能调用系统 I/O 的api</li>
<li>不能调用Date.now()或者Math.random()等不纯的方法，避免每次得到不一样的结果</li>
</ol>
<h3 id="应用方法"><a href="#应用方法" class="headerlink" title="应用方法"></a>应用方法</h3><p>store.dispatch方法会触发reducer自动执行。<br>在生成Store的时候，要将reducer传入createStore方法中<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import &#123;createStore&#125; from <span class="string">'redux'</span></div><div class="line">const store = createStore(reducer)</div></pre></td></tr></table></figure></p>
<p>因为reducer是纯函数，因此reducer不能改变state，而是返回一个全新的对象，因此经常这样写：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// state为对象</div><div class="line"><span class="keyword">function</span> reducer(state, action) &#123;</div><div class="line">    <span class="built_in">return</span> Object.assign(&#123;&#125;, state, &#123;thingToChange&#125;)</div><div class="line">    或者</div><div class="line">    <span class="built_in">return</span> &#123;...state, ...newState&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">// state为数组</div><div class="line"><span class="keyword">function</span> reducer(state, action) &#123;</div><div class="line">    <span class="built_in">return</span> [...state, newItem]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>取名reducer是因为经常会有对action进行批量操作的行为，批量操作时，经常用到es5的reduce方法：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const actions = [</div><div class="line">    &#123;<span class="built_in">type</span>: <span class="string">'ADD'</span>, payload: 0&#125;,</div><div class="line">    &#123;<span class="built_in">type</span>: <span class="string">'ADD'</span>, payload: 1&#125;,</div><div class="line">    &#123;<span class="built_in">type</span>: <span class="string">'ADD'</span>, payload: 2&#125;</div><div class="line">]</div><div class="line">const total = actions.reduce(reducer, 0)      // 3</div></pre></td></tr></table></figure></p>
<h3 id="拆分"><a href="#拆分" class="headerlink" title="拆分"></a>拆分</h3><p>由于只有一个state，因此state会很大。若不同的action所需要改变的state没有联系，则在reducer里面可以进行拆分<br>如：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">const chatReducer = (state = defaultState, action = &#123;&#125;) =&gt; &#123;</div><div class="line">    const &#123;<span class="built_in">type</span>, payload&#125; = action</div><div class="line">    switch(<span class="built_in">type</span>) &#123;</div><div class="line">        <span class="keyword">case</span>: ADD_CHAT:</div><div class="line">            <span class="built_in">return</span> Object.assign(&#123;&#125;, state, &#123;</div><div class="line">                chatLog: state.chatLog.concat(payload)</div><div class="line">            &#125;)</div><div class="line">        <span class="keyword">case</span> CHANGE_STATUS:</div><div class="line">            <span class="built_in">return</span> Object.assign(&#123;&#125;, state, &#123;</div><div class="line">                statusMessage: payload</div><div class="line">            &#125;);</div><div class="line">        <span class="keyword">case</span> CHANGE_USERNAME:</div><div class="line">            <span class="built_in">return</span> Object.assign(&#123;&#125;, state, &#123;</div><div class="line">                userName: payload</div><div class="line">            &#125;);</div><div class="line">        default: <span class="built_in">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面三中action没有联系，因此可拆分<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">const chatReducer = (state = defaultState, action = &#123;&#125;) =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        chatLog: ChatLogReducer(state.chatLog, action),</div><div class="line">        statusMessage: StatusMessageReducer(state.statusMessage, action),</div><div class="line">        userName: UserNameReducer(state.userName, action)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>redux为了方便进行拆分，还提供了一个combineReducers方法，用来方便把拆分的合成一个reducer<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import &#123;combineReducers&#125; from <span class="string">'redux'</span></div><div class="line">const chatReducer = combineReducers(&#123;</div><div class="line">    chatLog: ChatLogReducer,</div><div class="line">    statusMessage: StatusMessageReducer,</div><div class="line">    userName: UserNameReducer</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h2><p>Store可以实用store.subscribe方法设置监听函数，一旦state发生变化，就自动执行这个函数<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">import &#123;createStore&#125; from <span class="string">'redux'</span></div><div class="line">const store = createStore(reducer)</div><div class="line"></div><div class="line">store.subscribe(listener)</div></pre></td></tr></table></figure></p>
<h2 id="unsubscribe"><a href="#unsubscribe" class="headerlink" title="unsubscribe"></a>unsubscribe</h2><p>redux没有unsubscribe这个方法。可通过直接调用store.subscribe方法，来解除监听<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> unsubscribe = store.subscribe(() =&gt; &#123;</div><div class="line">    console.log(<span class="string">'..'</span>)</div><div class="line">&#125;)</div><div class="line">unsubscribe()       //解除监听</div></pre></td></tr></table></figure></p>
<h2 id="redux优化"><a href="#redux优化" class="headerlink" title="redux优化"></a>redux优化</h2><p>组件的初始加载和卸载，react本身已经做了优化，开发需要做的主要为更新时的优化。<br>更新时react做了优化，主要为通过算法来判断哪些组件需要进行更新。但是这个对比算法的过程，实际也是需要耗费时间和性能。因此开发可在这个过程上进行优化。</p>
<h3 id="单个组件优化"><a href="#单个组件优化" class="headerlink" title="单个组件优化"></a>单个组件优化</h3><p>一个react的应用通常是多个组件的集合。先在单个组件中，把组件自身在更新中，是否需要重新渲染的过程判断好<br>首先确定影响渲染内容的prop，然后在shouldComponentUpdate中判断返回。<br>若返回false则不用进行后续的判断更新</p>
<ol>
<li><p>有状态组件<br>有状态组件在shouldComponentUpdate函数中判断</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">shouldComponentUpdate(nextProps, nextState) &#123;</div><div class="line">    <span class="built_in">return</span> (nextProps.completed !== this.props.completed) || (nextProps.text !== this.props.text)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>无状态组件<br>无状态组件通常就是一个function，没有判断更新函数。对于无状态组件，可以在export时加上无参数的connect，即为永远不需要更新的组件</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> default connect()(TodoItem)</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="传递组件prop优化"><a href="#传递组件prop优化" class="headerlink" title="传递组件prop优化"></a>传递组件prop优化</h3><p>在对子组件的状态进行比对时，经常会通过父组件传递的prop进行比对，由于react经常是用浅层比较<code>===</code>来进行比对，因此传递给子组件的prop需要指向一个对象，而不是每次都新建一个对象<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 这个子组件每次都会被重新渲染</div><div class="line">&lt;Foo style=&#123;&#123;color: <span class="string">'red'</span>&#125;&#125; /&gt;</div><div class="line"></div><div class="line">// 这个子组件不会被重新渲染</div><div class="line">const fooStyle = &#123;color: <span class="string">'red'</span>&#125;     //不要放在render中。只初始化时执行一次</div><div class="line">&lt;Foo style=&#123;fooStyle&#125;&gt;</div></pre></td></tr></table></figure></p>
<h3 id="多个组件优化"><a href="#多个组件优化" class="headerlink" title="多个组件优化"></a>多个组件优化</h3><p>多个组件更新时，一般会通过所传递的prop进入到单个组件内进行判断更新。<br>有另外一种情况，如子组件数组，从数组头部插入一个元素，则react会更新所有的子组件数组。<br>为解决这个问题，可以给每个子组件一个<code>key</code>的prop，每个<code>key</code>就是这个组件的唯一id。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;ul&gt;</div><div class="line">    &lt;TodoItem key=&#123;1&#125; text=<span class="string">"First"</span> /&gt;</div><div class="line">    &lt;TodoItem key=&#123;2&#125; text=<span class="string">"Second"</span> /&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<p>使用key时要注意两点：</p>
<ol>
<li>key任何时候都不能变化。<br>比如不要适用each循环中的index来作为key，因为这个key很容易就发生改变</li>
<li>子组件获取不到这个key<br><code>key</code>和<code>prop</code>是React保留的两个特殊prop，不能被组件直接访问</li>
</ol>
<h3 id="view组件中获取state数据优化"><a href="#view组件中获取state数据优化" class="headerlink" title="view组件中获取state数据优化"></a>view组件中获取state数据优化</h3><p>在view组件中，经常会有筛选获取state中的数组之类的操作，这个过程经常也会耗费时间和性能。<br>可通过reselect工具来进行优化<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -S reselect</div></pre></td></tr></table></figure></p>
<p><code>reselect</code>会记忆一个最小的状态，来进行判断更新渲染<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// 把view组件中获取state数组的逻辑提取成selector.js</div><div class="line">import &#123;createSelector&#125; from <span class="string">'reselect'</span></div><div class="line">import &#123;FilterTypes&#125; from <span class="string">'../constants'</span></div><div class="line">const getFilter = state =&gt; state.filter</div><div class="line">const getTodos = state =&gt; state.todos</div><div class="line"><span class="built_in">export</span> const selectVisibleTodos = createSelector(</div><div class="line">    [getFilter, getTodos],</div><div class="line">    (filter, todos) =&gt; &#123;</div><div class="line">        switch (filter) &#123;</div><div class="line">            <span class="keyword">case</span> FilterTypes.ALL:</div><div class="line">                <span class="built_in">return</span> todos</div><div class="line">            <span class="keyword">case</span> FilterTypes.COMPLETED:</div><div class="line">                <span class="built_in">return</span> todos.filter(item =&gt; item.completed)</div><div class="line">            <span class="keyword">case</span> FilterTypes.UNCOMPLETED:</div><div class="line">                <span class="built_in">return</span> todos.filter(item =&gt; !item.completed)</div><div class="line">            default:</div><div class="line">                throw new Error(<span class="string">'unsupported filter'</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">)</div><div class="line">// view组件中调用</div><div class="line">import &#123;selectVisibleTodos&#125; from <span class="string">'../selector'</span></div><div class="line">const mapStateToProps = state =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> (</div><div class="line">        todos: selectVisibleTodos(state)</div><div class="line">    )</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="redux总结"><a href="#redux总结" class="headerlink" title="redux总结"></a>redux总结</h2><p>redux的流程总结为：</p>
<ol>
<li><p>用户发出action</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store.dispatch(action)</div></pre></td></tr></table></figure>
</li>
<li><p>store自动调用reducer，并传入2个参数：当前state和收到的action。reducer返回新的state</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> nextState = todoApp(previousState, action)</div></pre></td></tr></table></figure>
</li>
<li><p>state一旦有变化，store就会调用监听函数</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store.subscribe(listener)</div></pre></td></tr></table></figure>
</li>
<li><p>listener通过store.getState()方法获取当前state，然后可以触发setState重新渲染</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">listener</span></span>() &#123;</div><div class="line">    <span class="built_in">let</span> newState = store.getState()</div><div class="line">    component.setState(newState)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>一个完整的例子：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">const Counter = (&#123;value, onIncrement, onDecrement&#125;) =&gt; &#123;</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;h1&gt;&#123;value&#125;&lt;/h1&gt;</div><div class="line">        &lt;button onClick=&#123;onIncrement&#125;&gt;+&lt;/button&gt;</div><div class="line">        &lt;button onClick=&#123;deIncrement&#125;&gt;-&lt;/button&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&#125;</div><div class="line">const reducer = (state = 0, action) =&gt; &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'INCREMENT'</span>: <span class="built_in">return</span> state + 1</div><div class="line">        <span class="keyword">case</span> <span class="string">'DECREMENT'</span>: <span class="built_in">return</span> state - 1</div><div class="line">        default: <span class="built_in">return</span> state</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">const store = createStore(reducer)</div><div class="line">const render = () =&gt; &#123;</div><div class="line">    ReactDOM.render(</div><div class="line">        &lt;Counter</div><div class="line">            value = &#123;store.getState()&#125;</div><div class="line">            onIncrement = &#123;() =&gt; store.dispatch(&#123;<span class="built_in">type</span>: <span class="string">'INCREMENT'</span>&#125;)&#125;</div><div class="line">            onDecrement = &#123;() =&gt; store.dispatch(&#123;<span class="built_in">type</span>: <span class="string">'DECREMENT'</span>&#125;)&#125;</div><div class="line">        /&gt;,</div><div class="line">        document.getElementById(<span class="string">'root'</span>)</div><div class="line">    )</div><div class="line">&#125;</div><div class="line">render()</div><div class="line">store.subscribe(render)</div></pre></td></tr></table></figure></p>
<h1 id="redux中请求服务器"><a href="#redux中请求服务器" class="headerlink" title="redux中请求服务器"></a>redux中请求服务器</h1><h2 id="本地开发代理"><a href="#本地开发代理" class="headerlink" title="本地开发代理"></a>本地开发代理</h2><p>本地开发时，请求服务器会遇到跨域问题。create-react-app可直接在根目录的package.json中定义代理proxy<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"weather_react"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</div><div class="line">  <span class="string">"private"</span>: <span class="literal">true</span>,</div><div class="line">  <span class="string">"proxy"</span>: <span class="string">"http://www.weather.com.cn/"</span>,</div><div class="line">  <span class="string">"devDependencies"</span>: &#123;</div><div class="line">    <span class="string">"react-scripts"</span>: <span class="string">"0.8.4"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"dependencies"</span>: &#123;</div><div class="line">    <span class="string">"react"</span>: <span class="string">"^15.4.1"</span>,</div><div class="line">    <span class="string">"react-dom"</span>: <span class="string">"^15.4.1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"start"</span>: <span class="string">"react-scripts start"</span>,</div><div class="line">    <span class="string">"build"</span>: <span class="string">"react-scripts build"</span>,</div><div class="line">    <span class="string">"test"</span>: <span class="string">"react-scripts test --env=jsdom"</span>,</div><div class="line">    <span class="string">"eject"</span>: <span class="string">"react-scripts eject"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="redux中使用thunk中间件请求服务器"><a href="#redux中使用thunk中间件请求服务器" class="headerlink" title="redux中使用thunk中间件请求服务器"></a>redux中使用thunk中间件请求服务器</h2><p>如果把fetch请求放到redux中，由于redux的dispatch到action到reducer都是同步操作的，在服务器返回结果之前就已经更新完成了。因此，无法直接在reducer中调用更新。通过redux-thunk中间件来专门解决这个问题。<br>具体操作可到中间件中了解</p>
<h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><p>中间件的操作原理，即是在dispatch一个action到reducer之前，中间件会获取到action，做相应的处理之后，发送给reducer。<br>如果想使用中间件，则派发的action不能是一个带type的json对象，而应该是一个函数，这个函数带dispatch和getState两个参数。<br>中间件处理之后，会dispatch一个正常的action到reducer。</p>
<h2 id="常用的中间件"><a href="#常用的中间件" class="headerlink" title="常用的中间件"></a>常用的中间件</h2><h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3><p>让Store上的dispatch(action)支持异步操作。<br>若action为function，则会进行拦截，然后执行这个function，最后自动dispatch一个常规的action<br>比如用于向服务端发送异步请求。</p>
<h3 id="redux-immutable-state-invariant"><a href="#redux-immutable-state-invariant" class="headerlink" title="redux-immutable-state-invariant"></a>redux-immutable-state-invariant</h3><p>redux的原则是不改变Store上的state，通常是返回一个新的state。<br>为了避免出现直接修改state，通过此组件进行检测。<br>不过通常只用于开发环境。</p>
<h2 id="中间件配置"><a href="#中间件配置" class="headerlink" title="中间件配置"></a>中间件配置</h2><p>如配置redux-thunk（有两种配置中间件的方法，此为其中一种）<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// Store.js</div><div class="line">import &#123;createStore, combineReducers, applyMiddleware, compose&#125; from <span class="string">'redux'</span></div><div class="line">import thunkMiddleware from <span class="string">'redux-thunk'</span></div><div class="line">import Perf from <span class="string">'react-addons-perf'</span>    //性能检测，react16之后放弃了</div><div class="line">import &#123;reducer as weatherReducer&#125; from <span class="string">'./weather'</span></div><div class="line"></div><div class="line">const win = window</div><div class="line">win.Perf = Perf</div><div class="line"></div><div class="line">const reducer = combineReducers(&#123;</div><div class="line">    weather: weatherReducer</div><div class="line">&#125;)</div><div class="line"></div><div class="line">const middlewares = [thunkMiddleware]   //此处把所有的中间件添加到数组中</div><div class="line"><span class="keyword">if</span>(process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</div><div class="line">    middlewares.push(require(<span class="string">'redux-immutable-state-invariant'</span>)())  //检查是否改变了store</div><div class="line">&#125;</div><div class="line">const storeEnhancers = compose(     //compose(funcA, funcB, funcC) 形象为 compose(funcA(funcB(funcC())))</div><div class="line">    applyMiddleware(...middlewares),</div><div class="line">    (win &amp;&amp; win.devToolsExtension) ? win.devToolsExtension() : (f) =&gt; f</div><div class="line">)</div><div class="line"></div><div class="line"><span class="built_in">export</span> default createStore(reducer, &#123;&#125;, storeEnhancers)</div></pre></td></tr></table></figure></p>
<h2 id="中间件示例"><a href="#中间件示例" class="headerlink" title="中间件示例"></a>中间件示例</h2><p>如一个ajax请求的中间件例子：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">//action.js</div><div class="line"><span class="built_in">export</span> const fetchWeatherStarted = () =&gt; (&#123;</div><div class="line">    <span class="built_in">type</span>: FETCH_STARTED</div><div class="line">&#125;)</div><div class="line"><span class="built_in">export</span> const fetchWeatherSuccess = result =&gt; (&#123;</div><div class="line">    <span class="built_in">type</span>: FETCH_SUCCESS,</div><div class="line">    result</div><div class="line">&#125;)</div><div class="line"><span class="built_in">export</span> const fetchWeatherFailure = error =&gt; (&#123;</div><div class="line">    <span class="built_in">type</span>: FETCH_FAILURE,</div><div class="line">    error</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">export</span> const fetchWeather = cityCode =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> (dispatch) =&gt; &#123;</div><div class="line">        const apiUrl = `/data/cityinfo/<span class="variable">$&#123;cityCode&#125;</span>.html`</div><div class="line">        dispatch(fetchWeatherStarted())</div><div class="line"></div><div class="line">        fetch(apiUrl).then(response =&gt; &#123;</div><div class="line">            <span class="keyword">if</span>(response.status !== 200) &#123;</div><div class="line">                throw new Error(<span class="string">'Fail to get data'</span> + response.status)</div><div class="line">            &#125;</div><div class="line">            response.json().then(responseJson =&gt; &#123;</div><div class="line">                dispatch(fetchWeatherSuccess())</div><div class="line">            &#125;).catch(error =&gt; &#123;</div><div class="line">                throw new Error(<span class="string">'Invalid json response:'</span> + error)</div><div class="line">            &#125;)</div><div class="line">        &#125;).catch(error =&gt; &#123;</div><div class="line">            dispatch(fetchWeatherFailure(error))</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// reducer.js</div><div class="line"><span class="built_in">export</span> default (state = &#123;status: Status.LOADING&#125;, action) =&gt; &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        <span class="keyword">case</span> FETCH_START: &#123;</div><div class="line">            <span class="built_in">return</span> &#123;status: Status.LOADING&#125;</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// view.js</div><div class="line">const Weather = (&#123;status, cityName, weather, lowestTemp, highestTemp&#125;) =&gt; &#123;</div><div class="line">    switch(status) &#123;</div><div class="line">        <span class="keyword">case</span> Status.LOADING: &#123;</div><div class="line">            <span class="built_in">return</span> &lt;div&gt;天气请求中&lt;/div&gt;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> Status.SUCCESS: &#123;</div><div class="line">            <span class="built_in">return</span> (</div><div class="line">                &lt;div&gt;</div><div class="line">                    &#123;cityName&#125; &#123;weather&#125; 最低气温 &#123;lowerTemp&#125; 最高气温 &#123;highestTemp&#125;</div><div class="line">                &lt;/div&gt;</div><div class="line">            )</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">case</span> Status.FAILURE: &#123;</div><div class="line">            <span class="built_in">return</span> &lt;div&gt;天气信息装载失败&lt;/div&gt;</div><div class="line">        &#125;</div><div class="line">        default: &#123;</div><div class="line">            throw new Error(<span class="string">'unexpected status'</span> + status)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Weather.protoTypes = &#123;</div><div class="line">    status: PropTypes.string.isRequired,</div><div class="line">    cityName: PropTypes.string,</div><div class="line">    weather: PropTypes.string,</div><div class="line">    lowestTemp: PropTypes.string,</div><div class="line">    highestTemp: PropTypes.string</div><div class="line">&#125;</div><div class="line">const mapStateToProps = state =&gt; &#123;</div><div class="line">    const weatherData = state.weather</div><div class="line"></div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        status: weatherData.status</div><div class="line">        cityName: weatherData.cityName</div><div class="line">        weather: weatherData.weather</div><div class="line">        lowestTemp: weatherData.temp1</div><div class="line">        highestTemp: weatherData.temp2</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default connect(mapStateToProps)(Weather)</div></pre></td></tr></table></figure></p>
<h2 id="中间件取消之前的操作"><a href="#中间件取消之前的操作" class="headerlink" title="中间件取消之前的操作"></a>中间件取消之前的操作</h2><p>比如发送完ajax请求之后，想取消之前的发送，jquery有abort()函数可以实现，但是fetch之类的并没有这个操作。可通过一下技巧实现。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> nextSeqId = 0</div><div class="line"><span class="built_in">export</span> const fetchWeather = cityCode =&gt; &#123;</div><div class="line">    <span class="built_in">return</span> (dispatch) =&gt; &#123;</div><div class="line">        const apiUrl = `/data/cityinfo/<span class="variable">$&#123;cityCode&#125;</span>.html`</div><div class="line">        const seqId = ++nextSeqId</div><div class="line">        const dispatchIfValid = action =&gt; &#123;     //由于是回调，新dispatch来的时候之前的dispatch还没完成，则之前的不会执行</div><div class="line">            <span class="keyword">if</span>(seqId === nextSeqId) &#123;</div><div class="line">                dispatch(action)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        dispatchIfValid(fetchWeatherStarted())</div><div class="line"></div><div class="line">        fetch(apiUrl).then(response =&gt; &#123;</div><div class="line">            <span class="keyword">if</span>(response.status !== 200) &#123;</div><div class="line">                throw new Error(<span class="string">'Fail to get data'</span> + response.status)</div><div class="line">            &#125;</div><div class="line">            response.json().then(responseJson =&gt; &#123;</div><div class="line">                dispatchIfValid(fetchWeatherSuccess(responseJson.weatherInfo))</div><div class="line">            &#125;).catch(error =&gt; &#123;</div><div class="line">                throw new Error(<span class="string">'Invalid json response:'</span> + error)</div><div class="line">            &#125;)</div><div class="line">        &#125;).catch(error =&gt; &#123;</div><div class="line">            dispatchIfValid(fetchWeatherFailure(error))</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="自定义中间件"><a href="#自定义中间件" class="headerlink" title="自定义中间件"></a>自定义中间件</h2><p>中间件处理的是action对象，action在通过dispatch进入reducer之前，会经历中间件的管道。<br>在这个管道中，每个中间件都会接收到action，处理完成之后，会交给下一个中间件，最后派发给reducer来处理。<br>若某个中间件，觉得没必要继续处理了，就不会把action交给下一个中间件。处理就到此为止了。</p>
<p>中间件必须要定义成一个函数，返回一个接受next参数的函数。<br>如：一个什么都不做的中间件<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="keyword">do</span>NothingMiddleware(&#123;dispatch, getState&#125;) &#123;</div><div class="line">    <span class="built_in">return</span> <span class="keyword">function</span>(next) &#123;</div><div class="line">        <span class="built_in">return</span> <span class="keyword">function</span>(action) &#123;</div><div class="line">            <span class="built_in">return</span> next(action)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">此函数用es6实现：</div><div class="line">const <span class="keyword">do</span>NothingMiddleware = (&#123;dispatch, getState&#125;) =&gt; next =&gt; action =&gt; next(action)</div></pre></td></tr></table></figure></p>
<p>像这么写的原因，是根据函数式变成来设计的。目的是让每个函数的功能尽量小，然后通过函数的嵌套来实现复杂功能。<br>自己实现redux-thunk中间件：<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> createThunkMiddleware(extraArgument) &#123;</div><div class="line">    <span class="built_in">return</span> (&#123;dispatch, getState&#125;) =&gt; next =&gt; action =&gt; &#123;</div><div class="line">        <span class="keyword">if</span>(typeof action === <span class="string">'function'</span>) &#123;</div><div class="line">            <span class="built_in">return</span> action(dispatch, getState, extraArgument)</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> next(action)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">const thunk = createThunkMiddleware()</div><div class="line"><span class="built_in">export</span> default thunk</div></pre></td></tr></table></figure></p>
<h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h1><h1 id="React-Router"><a href="#React-Router" class="headerlink" title="React-Router"></a>React-Router</h1><h2 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h2><p>通过一个实例来说明react-router是怎么管理一个基本路由的<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">// 1. 应用入口 src/index.js</div><div class="line">import React from <span class="string">'react'</span></div><div class="line">import ReactDOM from <span class="string">'react-dom'</span></div><div class="line">import Routes from <span class="string">'./Routes.js'</span></div><div class="line">ReactDOM.render(</div><div class="line">  &lt;Routes /&gt;,</div><div class="line">  document.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div><div class="line"></div><div class="line">// 2. 定义好Routes路由文件 src/Routes.js</div><div class="line">import React from <span class="string">'react'</span></div><div class="line">import &#123;Router, Route, browserHistory&#125; from <span class="string">'react-router'</span></div><div class="line">imort Home from <span class="string">'./pages/Home.js'</span></div><div class="line">imort About from <span class="string">'./pages/About.js'</span></div><div class="line">imort NotFound from <span class="string">'./pages/NotFound.js'</span></div><div class="line"></div><div class="line">const <span class="built_in">history</span> = browserHistory    //跟随浏览器的<span class="built_in">history</span></div><div class="line">const Routes = () =&gt; (</div><div class="line">  &lt;Router <span class="built_in">history</span>=&#123;browserHistory&#125;&gt;</div><div class="line">    &lt;Route path=<span class="string">"home"</span> component=&#123;Home&#125; /&gt;</div><div class="line">    &lt;Route path=<span class="string">"about"</span> component=&#123;About&#125; /&gt;</div><div class="line">    &lt;Route path=<span class="string">"*"</span> component=&#123;NotFound&#125; /&gt;</div><div class="line">  &lt;/Router&gt;</div><div class="line">)</div><div class="line"><span class="built_in">export</span> default Routes</div><div class="line"></div><div class="line">// 3. 所有文件都引入一个文件的技巧，如引入顶部导航</div><div class="line">// src/pages/App.js</div><div class="line">import React from <span class="string">'react'</span></div><div class="line">import &#123;view as TopMenu&#125; from <span class="string">'./components/TopMenu'</span></div><div class="line">const App = (&#123;children&#125;) =&gt; &#123;</div><div class="line">  <span class="built_in">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;TopMenu /&gt;</div><div class="line">      &lt;div&gt;&#123;children&#125;&lt;/div&gt;     //此处实际匹配的是路由的内容</div><div class="line">    &lt;/div&gt;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> default App</div><div class="line"></div><div class="line">// 修改 src/Routes.js</div><div class="line">添加了一层路由，将根路径映射到App组件上，如找路由/home时，会先找到/，就加载App组件，然后匹配后面的组件，会把后面的组件当children属性传递给前面的组件。</div><div class="line">const Routes = () =&gt; (</div><div class="line">    &lt;Router <span class="built_in">history</span>=&#123;<span class="built_in">history</span>&#125;&gt;</div><div class="line">      &lt;Route path=<span class="string">"/"</span> component=&#123;App&#125;&gt;    //添加了一层路由</div><div class="line">        &lt;Route path=<span class="string">"home"</span> component=&#123;Home&#125; /&gt;</div><div class="line">        &lt;Route path=<span class="string">"about"</span> component=&#123;About&#125; /&gt;</div><div class="line">        &lt;Route path=<span class="string">"*"</span> component=&#123;NotFound&#125; /&gt;</div><div class="line">      &lt;/Route&gt;</div><div class="line">    &lt;/Router&gt;</div><div class="line">)</div><div class="line"></div><div class="line">// 4. view中使用路由切换 src/TopMenu/index.js</div><div class="line">import React from <span class="string">'react'</span></div><div class="line">import &#123;Link&#125; from <span class="string">'react-router'</span></div><div class="line">const view = () =&gt; &#123;</div><div class="line">  <span class="built_in">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;ul&gt;</div><div class="line">            &lt;li&gt;&lt;Link to=<span class="string">"/home"</span>&gt;Home&lt;/Link&gt;&lt;/li&gt;</div><div class="line">            &lt;li&gt;&lt;Link to=<span class="string">"/about"</span>&gt;About&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;/ul&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"><span class="built_in">export</span> &#123;view&#125;</div></pre></td></tr></table></figure></p>
<h3 id="默认链接"><a href="#默认链接" class="headerlink" title="默认链接"></a>默认链接</h3><p>可通过IndexRoute给定默认路由，根路径上可显示此路由。<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Router <span class="built_in">history</span>=&#123;<span class="built_in">history</span>&#125;&gt;</div><div class="line">  &lt;Route path=<span class="string">"/"</span> component=&#123;App&#125;&gt;</div><div class="line">    &lt;IndexRoute component=&#123;Home&#125; /&gt;</div><div class="line">    &lt;Route path=<span class="string">"home"</span> component=&#123;Home&#125; /&gt;</div><div class="line">    &lt;Route path=<span class="string">"about"</span> component=&#123;About&#125; /&gt;</div><div class="line">    &lt;Route path=<span class="string">"*"</span> component=&#123;NotFound&#125; /&gt;</div><div class="line">  &lt;/Route&gt;</div><div class="line">&lt;/Router&gt;</div></pre></td></tr></table></figure></p>
<h2 id="集合redux路由"><a href="#集合redux路由" class="headerlink" title="集合redux路由"></a>集合redux路由</h2><p>没太弄明白，可继续学习</p>
<ol>
<li><p>Provider处于顶端</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">      &lt;Routes /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    document.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p>使用Router的createElement属性</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">import store from <span class="string">'./Store.js'</span></div><div class="line">const createElement = (Component, props) =&gt; &#123;</div><div class="line">  <span class="built_in">return</span> (</div><div class="line">      &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">        &lt;Component &#123;...props&#125; /&gt;</div><div class="line">      &lt;/Provider&gt;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line">const Routes = () =&gt; (</div><div class="line">  &lt;Router <span class="built_in">history</span>=&#123;<span class="built_in">history</span>&#125; createElement=&#123;createElement&#125;&gt;</div><div class="line">  ...</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="单个页面单独打包js"><a href="#单个页面单独打包js" class="headerlink" title="单个页面单独打包js"></a>单个页面单独打包js</h2><p>使用React-router之后可将多个页面构建成单页应用，将所有页面的js打包成一个bundle.js。若是大型应用会影响体验。<br>因此需要每个页面单独打包。<br>合理的结构：整个应用的bundle.js，通用内容的common.js，每个页面的js<br>具体可看书本配置。</p>

      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/javascript/" rel="tag">#javascript</a>
          
            <a href="/tags/react/" rel="tag">#react</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/19/vue-upgrade/" rel="next" title="Vue知识点查漏补缺">
                <i class="fa fa-chevron-left"></i> Vue知识点查漏补缺
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/08/css3-flex/" rel="prev" title="flex布局">
                flex布局 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Chavin" />
          <p class="site-author-name" itemprop="name">Chavin</p>
          <p class="site-description motion-element" itemprop="description">争取明日不被后浪拍在沙滩上</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">81</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">103</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/biedalianoh" target="_blank">
                  
                    <i class="fa fa-globe"></i> Github
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/biedalian_oh" target="_blank">
                  
                    <i class="fa fa-globe"></i> weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.biedalianoh.com" target="_blank">
                  
                    <i class="fa fa-globe"></i> 个人站点
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#兼容"><span class="nav-number">1.</span> <span class="nav-text">兼容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#导入react"><span class="nav-number">2.</span> <span class="nav-text">导入react</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#react构建工具"><span class="nav-number">3.</span> <span class="nav-text">react构建工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#create-react-app"><span class="nav-number">3.1.</span> <span class="nav-text">create-react-app</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令"><span class="nav-number">3.1.1.</span> <span class="nav-text">命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-boilerplate"><span class="nav-number">3.2.</span> <span class="nav-text">react-boilerplate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-redux-starter-kit"><span class="nav-number">3.3.</span> <span class="nav-text">react-redux-starter-kit</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#组件构建方式"><span class="nav-number">4.</span> <span class="nav-text">组件构建方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#React-createClass"><span class="nav-number">4.1.</span> <span class="nav-text">React.createClass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES6-classes"><span class="nav-number">4.2.</span> <span class="nav-text">ES6 classes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无状态函数"><span class="nav-number">4.3.</span> <span class="nav-text">无状态函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React组件命名"><span class="nav-number">5.</span> <span class="nav-text">React组件命名</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React生命周期"><span class="nav-number">6.</span> <span class="nav-text">React生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#装载–第一次被渲染"><span class="nav-number">6.1.</span> <span class="nav-text">装载–第一次被渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新"><span class="nav-number">6.2.</span> <span class="nav-text">更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#卸载"><span class="nav-number">6.3.</span> <span class="nav-text">卸载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React数据流"><span class="nav-number">7.</span> <span class="nav-text">React数据流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#state"><span class="nav-number">7.1.</span> <span class="nav-text">state</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setState"><span class="nav-number">7.1.1.</span> <span class="nav-text">setState</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props"><span class="nav-number">7.2.</span> <span class="nav-text">props</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#props数据规范"><span class="nav-number">7.2.1.</span> <span class="nav-text">props数据规范</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#refs"><span class="nav-number">7.3.</span> <span class="nav-text">refs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件拆分"><span class="nav-number">7.4.</span> <span class="nav-text">组件拆分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原生组件拆分"><span class="nav-number">7.4.1.</span> <span class="nav-text">原生组件拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#react-redux组件拆分"><span class="nav-number">7.4.2.</span> <span class="nav-text">react-redux组件拆分</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#子组件通知父组件"><span class="nav-number">8.</span> <span class="nav-text">子组件通知父组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#react原生方式"><span class="nav-number">8.1.</span> <span class="nav-text">react原生方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React之外DOM操作"><span class="nav-number">9.</span> <span class="nav-text">React之外DOM操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React的方法"><span class="nav-number">10.</span> <span class="nav-text">React的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#forceUpdate"><span class="nav-number">10.1.</span> <span class="nav-text">forceUpdate</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flux"><span class="nav-number">11.</span> <span class="nav-text">flux</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redux"><span class="nav-number">12.</span> <span class="nav-text">redux</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#如何创建并管理一个组件"><span class="nav-number">12.1.</span> <span class="nav-text">如何创建并管理一个组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个store"><span class="nav-number">12.2.</span> <span class="nav-text">创建一个store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原生获取store"><span class="nav-number">12.3.</span> <span class="nav-text">原生获取store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-redux-获取store"><span class="nav-number">12.4.</span> <span class="nav-text">react-redux 获取store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于state"><span class="nav-number">12.5.</span> <span class="nav-text">关于state</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getState"><span class="nav-number">12.6.</span> <span class="nav-text">getState</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#action"><span class="nav-number">12.7.</span> <span class="nav-text">action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dispatch"><span class="nav-number">12.8.</span> <span class="nav-text">dispatch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reducer"><span class="nav-number">12.9.</span> <span class="nav-text">reducer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义"><span class="nav-number">12.9.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用方法"><span class="nav-number">12.9.2.</span> <span class="nav-text">应用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拆分"><span class="nav-number">12.9.3.</span> <span class="nav-text">拆分</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#subscribe"><span class="nav-number">12.10.</span> <span class="nav-text">subscribe</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unsubscribe"><span class="nav-number">12.11.</span> <span class="nav-text">unsubscribe</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redux优化"><span class="nav-number">12.12.</span> <span class="nav-text">redux优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单个组件优化"><span class="nav-number">12.12.1.</span> <span class="nav-text">单个组件优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#传递组件prop优化"><span class="nav-number">12.12.2.</span> <span class="nav-text">传递组件prop优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多个组件优化"><span class="nav-number">12.12.3.</span> <span class="nav-text">多个组件优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#view组件中获取state数据优化"><span class="nav-number">12.12.4.</span> <span class="nav-text">view组件中获取state数据优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redux总结"><span class="nav-number">12.13.</span> <span class="nav-text">redux总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redux中请求服务器"><span class="nav-number">13.</span> <span class="nav-text">redux中请求服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本地开发代理"><span class="nav-number">13.1.</span> <span class="nav-text">本地开发代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redux中使用thunk中间件请求服务器"><span class="nav-number">13.2.</span> <span class="nav-text">redux中使用thunk中间件请求服务器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#中间件"><span class="nav-number">14.</span> <span class="nav-text">中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#常用的中间件"><span class="nav-number">14.1.</span> <span class="nav-text">常用的中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-thunk"><span class="nav-number">14.1.1.</span> <span class="nav-text">redux-thunk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-immutable-state-invariant"><span class="nav-number">14.1.2.</span> <span class="nav-text">redux-immutable-state-invariant</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件配置"><span class="nav-number">14.2.</span> <span class="nav-text">中间件配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件示例"><span class="nav-number">14.3.</span> <span class="nav-text">中间件示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件取消之前的操作"><span class="nav-number">14.4.</span> <span class="nav-text">中间件取消之前的操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义中间件"><span class="nav-number">14.5.</span> <span class="nav-text">自定义中间件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#动画"><span class="nav-number">15.</span> <span class="nav-text">动画</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React-Router"><span class="nav-number">16.</span> <span class="nav-text">React-Router</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础路由"><span class="nav-number">16.1.</span> <span class="nav-text">基础路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#默认链接"><span class="nav-number">16.1.1.</span> <span class="nav-text">默认链接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合redux路由"><span class="nav-number">16.2.</span> <span class="nav-text">集合redux路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单个页面单独打包js"><span class="nav-number">16.3.</span> <span class="nav-text">单个页面单独打包js</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chavin</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  

  
  


</body>
</html>
